```{r}
library(clusterProfiler)
library(org.Hs.eg.db)  # For human genes
library(stringr)       # For wrapping text
library(ggplot2)       # For plotting

# List of input files
input_files <- c("OBP2A_-1_ranked_geneList.csv", 
                 "OBP2A_1_ranked_geneList.csv", 
                 "OBP2A_2_ranked_geneList.csv", 
                 "OBP2B_-1_ranked_geneList.csv", 
                 "OBP2B_1_ranked_geneList.csv", 
                 "OBP2B_2_ranked_geneList.csv")

# Loop over each file
for (file in input_files) {
  
  # Read the gene list from the file
  gene_list <- read.csv(file, row.names = 1)
  
  # Prepare the ranked gene list
  ranked_genes <- gene_list[[1]]  # Assuming the ranked gene list is in the first column
  names(ranked_genes) <- rownames(gene_list)
  ranked_genes <- sort(ranked_genes, decreasing = TRUE)  # Sort the list for GSEA
  
  # Run GSEA
  gsea_result <- gseGO(geneList = ranked_genes, 
                       OrgDb = org.Hs.eg.db,  # For human genes
                       ont = "BP",           # Ontology type (BP, CC, MF, or ALL)
                       keyType = "SYMBOL",   # Use gene symbols
                       minGSSize = 10,       # Minimum gene set size
                       maxGSSize = 500,      # Maximum gene set size
                       pvalueCutoff = 0.05,  # p-value cutoff
                       verbose = FALSE)      # Set verbose to FALSE to suppress output in loop
  
  # Generate the dotplot
  dotplot_obj <- dotplot(gsea_result, showCategory = 10)
  
  # Customize and modify the dotplot
  ggplot_data <- dotplot_obj +
    theme(axis.text.y = element_text(size = 8, angle = 45, hjust = 1))  # Rotate text, adjust size
  
  # Create a unique filename for the plot based on the input file name
  output_file <- paste0(sub(".csv", "", file), "_gsea_dotplot.pdf")
  
  # Save the dotplot to a PDF file
  pdf(output_file, width = 8, height = 6)
  print(ggplot_data)
  dev.off()
  
  # Optionally, print a message to confirm each file has been processed
  cat("Processed and saved:", output_file, "\n")
}

```

